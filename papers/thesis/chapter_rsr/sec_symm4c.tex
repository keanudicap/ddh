\section{Symmetry Breaking In 4-Connected Grid Maps}
\label{sec::rsr::symm4c}
Despite a wealth of research into symmetry breaking techniques in different
areas of the academic literature (e.g. planning~\cite{fox99}, constraint programming~\cite{walsh07}
and combinatorial optimisation~\cite{fukunaga08}) there is very little research on the topic 
in the context of pathfinding search.
As a first step, I will describe a simple technique for breaking symmetries in the context 
of 4-connected grid maps.
This is a domain which appears regularly in the academic literature
\cite{yap02,wang08,pochter09} and is often found in the pathfinding systems of
modern video games.  Some recent examples include Square Enix's \emph{Heroes of
Mana} (released in 2007 for the Nintendo DS), Astraware's \emph{My Little Tank}
(2008, iPhone) and Atari's \emph{Dragon Ball Z: Legacy of Goku} (2002, Gameboy
Advance).
\\
We propose the following offline strategy for identifying and eliminating symmetric paths in 
4-connected grid maps:

\begin{enumerate}
\item{Decompose the grid map into a set of empty rooms, where each empty room is
rectangular in shape and free of any obstacles.  The size of the rooms can vary
across a map, depending on the placement of the obstacles.}
\item{Prune all nodes from the interior but not the perimeter of each empty
room.}
\item{Add a series of \emph{macro edges} that connect each node on the perimeter
of an empty room with a set of nodes on the directly opposite side of the room.}
\item{When the start or goal is located in the interior of an empty rectangle, we use
a temporary node re-insertion procedure.  In a 4-connected map (shown here for
simplicity) we connect the temporary node, online, to the 4 nearest perimeter
nodes. A similar operation, involving sets of edges from each perimeter side, is
used when diagonal moves are allowed.}
\end{enumerate}

Trivial rooms which contain no interior nodes (for example rooms with a width $w$ or height $h$ 
$\leq 2$) are left unmodified by steps 2 and 3.
Figure \ref{fig-overview} shows an example of this process.
For each non-trivial room we prune $(w-2)\times(h-2)$ interior
nodes and, in the process, eliminate a large number of symmetric paths between 
nodes on the perimeter.
We claim that this approach preserves optimality when traversing across any arbitrary room.

\begin{lemma}
\label{thm-roomtraversal}
Let $R$ be an arbitrary rectangular room that is free of obstacles
and $m, n$ be two locations on its perimeter.
Then $m$ and $n$ can be connected optimally through a path that
mentions only nodes on the perimeter of $R$ and possibly involves
a macro edge.
\end{lemma}
\begin{proof}
\par
There are two distinct cases to consider.
Case 1 is when $m$ and $n$ are placed on the same side of the perimeter, or
on two orthogonal sides. 
To obtain an optimal path we can simply travel along the perimeter from $m$ to $n$.
Case 2 is when $m$ and $n$ are placed on opposite sides of the perimeter.
To obtain an optimal path we can simply follow the macro edge at $m$ 
and navigate directly to a node $m'$ located on
the same side of the perimeter as $n$. Then, go from $m'$ to $n$ along the perimeter.
The resultant path is optimal as its length is equal to the Manhattan distance between $m$ and $n$.
\end{proof}

A direct corollary to Lemma \ref{thm-roomtraversal} is that we can prune from consideration
all nodes from the interior of $R$ and limit ourselves to only searching nodes appearing along its perimeter. 
The only remaining consideration is how to deal with interior nodes that happen
to be the start or goal location for the search at hand.
We address this case in the following section.

